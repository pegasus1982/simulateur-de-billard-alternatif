(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,i){},18:function(e,t,i){e.exports=i(34)},23:function(e,t,i){},24:function(e,t,i){},32:function(e,t,i){},33:function(e,t,i){},34:function(e,t,i){"use strict";i.r(t);var a=i(3),n=i.n(a),s=i(16),o=i.n(s),r=(i(23),i(24),i(1)),l=i(4),c=i(7),h=i(5),u=i(6),p=i(12),f=(i(13),a.Component,i(25),i(2)),d="table.babylon",b="bat.babylon",m=396,v=5.715,R=6,k=7,y=8,V=9,w=10,_=11,g=12,M=13,x=14,S=15,A=16,N=function e(){Object(r.a)(this,e),this.played=!1},j=function e(){Object(r.a)(this,e)},C=function e(t,i){var a=this;Object(r.a)(this,e),this.delta_fgpas=.004375,this.RSG=1,this.fgpas=.00125,this.EPSILON=.86,this.frpas=3e-5,this.QCQ=2,this.Rfppas=75e-6,this.f1=.25,this.f2=.42,this.Rfp=.15,this.fbille=.05,this.pas=5e-4,this.fp1=.2,this.ARRET=0,this.TSP=3,this.fg=2.5,this.fr=.06,this.choc_bande=function(e){var t=NaN;if(a.X[e]>a.XMIN&&a.X[e]<a.XMAX&&a.Y[e]>a.YMIN&&a.Y[e]<a.YMAX)return!1;if(a.X[e]<a.XMIN&&a.Vx[e]>0)return!1;if(a.X[e]>a.XMAX&&a.Vx[e]<0)return!1;if(a.Y[e]>a.YMAX&&a.Vy[e]<0)return!1;if(a.Y[e]<a.YMIN&&a.Vy[e]>0)return!1;if(0==e&&(!a.choc12||!a.choc13)){var i=a,n=a.nbandes+1;if(i.nbandes=n,!a.choc12&&!a.choc13){i=a,n=a.nb_b_avant+1;i.nb_b_avant=n}}return a.etat[e]==a.RSG?(a.Rp[e]=-a.Vy[e],a.Rq[e]=a.Vx[e]):a.etat[e]==a.QCQ&&(a.Rp[e]=-a.Vy[e]+a.VQy[e],a.Rq[e]=a.Vx[e]-a.VQx[e]),a.init_pars(e),a.VMz=a.VT-a.VRr,a.VN0=-a.VN,a.VN=a.VN*-a.EPSILON,a.deltaVN=a.VN0+a.VN,a.intens=a.VN0/20,a.intens>1&&(a.intens=1),a.beta_adh=2/7*Math.sqrt(a.VMz*a.VMz+a.VRq*a.VRq),a.beta_gliss=a.f1*a.deltaVN,Math.abs(a.VMz)<1e-5?a.alpha_bande=Math.PI/2:a.alpha_bande=Math.abs(Math.atan(a.VRq/a.VMz)),t=Math.abs(a.fp1*a.deltaVN),Math.abs(a.VRp)<t?a.VRp=0:a.VRp>0?a.VRp=a.VRp-t:a.VRp=a.VRp+t,t=Math.abs(a.f2*a.deltaVN),a.VRq=a.VRq+t,a.beta_gliss>a.beta_adh?a.choc_adh(e):a.choc_gliss(e),a.recup_pars(e),a.VQx[e]=a.Vx[e]-a.Rq[e],a.VQy[e]=a.Vy[e]+a.Rp[e],a.etat[e]=a.QCQ,!0},this.fin_parcours=function(){var e=0;for(e=0;e<3;){if(a.etat[e]!=a.ARRET){if(!(a.Vx[e]*a.Vx[e]+a.Vy[e]*a.Vy[e]<a.frpas*a.frpas))return!1;if(!(Math.abs(a.Rr[e])<a.Rfppas))return a.etat[e]=a.TSP,!1;a.etat[e]=a.ARRET;var t=0;a.Vy[e]=0,a.Vx[e]=t;t=0;a.Rr[e]=0,a.Rq[e]=t,a.Rp[e]=t}e++}return!0},this.Calcul=function(e){console.log("parameter",e);var t,i,n=0,s=0,o=NaN,r=[];for(n=0;n<3;){for(a.nb_clefs[n]=0,s=0;s<a.nb_max_clefs;)a.evts[a.nb_max_clefs*n+s]=null,s++;n++}for(a.nb_sons=0,n=0;n<a.nb_max_sons;)a.evts_son[n]=null,n++;for(n=0;n<3;)a.X[n]=e.Xinit[n],a.Y[n]=e.Yinit[n],a.RAp[n]=e.RApInit[n],a.RAq[n]=e.RAqInit[n],a.RAr[n]=e.RArInit[n],a.add_clef(n),n++;a.el=e.el,a.er=e.er,a.alph=e.alphaQ,a.beta=e.betaQ,a.vqueue=e.Vqueue,a.calculs_finis=!1,a.nbandes=0,a.done=!1,a.distance13=2,a.first_bille_choquee=0,a.choc12=!1,a.choc13=!1,a.done=!1,a.deltaclef=a.resolution,a.date=0,a.beta=a.beta+Math.PI,a.Vinit=1.4*a.vqueue*Math.cos(a.alph/1.2),t=-2*a.Vinit/Math.cos(a.alph/1.1)*a.er/a.R;var l=Math.PI/20;o=a.alph>l?Math.PI/2/(Math.PI/2-l)*(a.alph-l):0,i=4*a.vqueue*Math.sin(o)*a.el/a.R,a.Vx[0]=a.Vinit*Math.cos(a.beta),a.Vx0=a.Vx[0],a.Vy[0]=a.Vinit*Math.sin(a.beta),a.Vy0=a.Vy[0];var c=t*Math.sin(a.beta)+i*Math.cos(a.beta);a.Rp[0]=t*Math.sin(a.beta)+i*Math.cos(a.beta),a.p0=c;c=-t*Math.cos(a.beta)+i*Math.sin(a.beta);a.Rq[0]=-t*Math.cos(a.beta)+i*Math.sin(a.beta),a.q0=c;c=2*a.el/a.R*a.Vinit;for(a.Rr[0]=2*a.el/a.R*a.Vinit,a.r0=c,a.VQx[0]=a.Vx[0]-a.Rq[0],a.VQy[0]=a.Vy[0]+a.Rp[0],a.etat[0]=a.QCQ,n=1;n<3;)a.Vx[n]=0,a.Vy[n]=0,a.VQx[n]=0,a.VQy[n]=0,a.Rp[n]=0,a.Rq[n]=0,a.Rr[n]=0,a.etat[n]=a.ARRET,a.add_clef(n),n++;for(a.evts_son[a.nb_sons]=new N,a.evts_son[a.nb_sons].played=!1,a.evts_son[a.nb_sons].temps=0,a.evts_son[a.nb_sons].intensite=a.Vinit/5.4,a.alph>Math.PI/4?a.evts_son[a.nb_sons].type_choc=0:a.evts_son[a.nb_sons].type_choc=1;!a.fin_parcours();)for(a.date+=1,a.choc_billes(r),n=0;n<3;){if(a.etat[n]!=a.ARRET){if(a.choc_bande(n)){a.add_clef(n),a.evts_son[a.nb_sons]=new N,a.evts_son[a.nb_sons].played=!1,a.evts_son[a.nb_sons].temps=a.date*a.pas,a.evts_son[a.nb_sons].intensite=a.intens,a.evts_son[a.nb_sons].type_choc=3;c=a;var h=a.nb_sons+1;c.nb_sons=h}a.mise_a_jour(n)&&a.add_clef(n)}(Math.abs(a.X[n]-a.X0[n])>a.deltaclef||Math.abs(a.Y[n]-a.Y0[n])>a.deltaclef||Math.abs(a.RAp[n]-a.RAp0[n])>a.deltaclefRot||Math.abs(a.RAq[n]-a.RAq0[n])>a.deltaclefRot||Math.abs(a.RAr[n]-a.RAr0[n])>a.deltaclefRot)&&a.add_clef(n),n++}if(a.fin_parcours()){a.calculs_finis=!0;for(n=0;n<3;n++)a.Xfin[n]=a.X[n],a.Yfin[n]=a.Y[n],a.RApfin[n]=a.RAp[n],a.RAqfin[n]=a.RAq[n],a.RArfin[n]=a.RAr[n],a.add_clef(n);a.duree=a.date*a.pas}else for(n=0;n<3;n++)a.add_clef(n);return a.evts},this.mise_a_jour=function(e){var t=NaN,i=NaN,n=NaN,s=NaN,o=NaN;if(0!=a.first_bille_choquee&&(a.nb3=3-a.first_bille_choquee,a.d13=Math.sqrt((a.X[0]-a.X[a.nb3])*(a.X[0]-a.X[a.nb3])+(a.Y[0]-a.Y[a.nb3])*(a.Y[0]-a.Y[a.nb3])),a.d13<a.distance13&&(a.distance13=a.d13)),a.etat[e]==a.RSG){if((t=Math.sqrt(a.Vx[e]*a.Vx[e]+a.Vy[e]*a.Vy[e]))<a.frpas){var r=0;a.Vy[e]=0,a.Vx[e]=r;r=0;if(a.Rq[e]=0,a.Rp[e]=r,Math.abs(a.Rr[e])<a.Rfppas)return a.etat[e]=a.ARRET,a.Rr[e]=0,a.add_clef(e),!0;a.etat[e]=a.TSP}a.etat[e]!=a.TSP&&(i=1-a.frpas/t,a.Vx[e]=a.Vx[e]*i,a.Vy[e]=a.Vy[e]*i,a.Rp[e]=-a.Vy[e],a.Rq[e]=a.Vx[e]),Math.abs(a.Rr[e])<a.Rfppas?a.Rr[e]=0:a.Rr[e]>0?a.Rr[e]=a.Rr[e]-a.Rfppas:a.Rr[e]=a.Rr[e]+a.Rfppas}if(a.etat[e]==a.QCQ&&((n=Math.sqrt(a.VQx[e]*a.VQx[e]+a.VQy[e]*a.VQy[e]))<a.delta_fgpas?a.etat[e]=a.RSG:(s=-a.fgpas*a.VQx[e]/n,o=-a.fgpas*a.VQy[e]/n,a.Vx[e]=a.Vx[e]+s,a.Vy[e]=a.Vy[e]+o,i=1-a.delta_fgpas/n,a.VQx[e]=a.VQx[e]*i,a.VQy[e]=a.VQy[e]*i),a.Rp[e]=-a.Vy[e]+a.VQy[e],a.Rq[e]=a.Vx[e]-a.VQx[e],Math.abs(a.Rr[e])<a.Rfppas?a.Rr[e]=0:a.Rr[e]>0?a.Rr[e]=a.Rr[e]-a.Rfppas:a.Rr[e]=a.Rr[e]+a.Rfppas),a.etat[e]==a.TSP){r=0;a.Vy[e]=0,a.Vx[e]=r;r=0;if(a.Rq[e]=0,a.Rp[e]=r,Math.abs(a.Rr[e])<a.Rfppas)return a.Rr[e]=0,a.etat[e]=a.ARRET,!0;a.Rr[e]>0?a.Rr[e]=a.Rr[e]-2*a.Rfppas:a.Rr[e]=a.Rr[e]+2*a.Rfppas}return a.X[e]=a.X[e]+a.Vx[e]*a.pas,a.Y[e]=a.Y[e]+a.Vy[e]*a.pas,a.RAp[e]=a.RAp[e]+a.Rp[e]*a.pas,a.RAq[e]=a.RAq[e]+a.Rq[e]*a.pas,a.RAr[e]=a.RAr[e]+a.Rr[e]*a.pas,!1},this.choc_gliss=function(e){a.VMz>0?(a.VT=a.VT-a.beta_gliss*Math.cos(a.alpha_bande),a.VRr=a.VRr+2.5*a.beta_gliss*Math.cos(a.alpha_bande)):(a.VT=a.VT+a.beta_gliss*Math.cos(a.alpha_bande),a.VRr=a.VRr-2.5*a.beta_gliss*Math.cos(a.alpha_bande))},this.choc_adh=function(e){var t,i,n=NaN,s=NaN,o=NaN,r=NaN,l=NaN,c=0;n=Math.abs(a.VT)<1e-5?90:180/Math.PI*Math.atan(a.VN0/a.VT),a.effet=100*a.R/2*a.VRr/Math.sqrt(a.VN0*a.VN0+a.VT*a.VT),a.effet<=-1.5?a.effet=-1.499:a.effet>1.5&&(a.effet=1.499),Math.abs(a.VT)<1e-5?s=a.effet>0?a.sorties[28]+(a.sorties[29]-a.sorties[28])*(a.effet/1.5):a.sorties[27]+(a.sorties[28]-a.sorties[27])*(a.effet+1.5)/1.5:(n=180/Math.PI*Math.atan(a.VN0/a.VT),c=parseInt(n/10),s=(o=a.effet>0?a.sorties[3*c+1]+(a.sorties[3*c+2]-a.sorties[3*c+1])*(a.effet/1.5):a.sorties[3*c+0]+(a.sorties[3*c+1]-a.sorties[3*c+0])*(a.effet+1.5)/1.5)+((a.effet>0?a.sorties[3*(c+1)+1]+(a.sorties[3*(c+1)+2]-a.sorties[3*(c+1)+1])*(a.effet/1.5):a.sorties[3*(c+1)+0]+(a.sorties[3*(c+1)+1]-a.sorties[3*(c+1)+0])*(a.effet+1.5)/1.5)-o)/10*(n-10*c)),Math.abs(s-90)<1e-5?a.VT=0:a.VT=s<90?a.VN/Math.tan(s/180*Math.PI):-a.VN*Math.tan((s-90)/180*Math.PI),Math.abs(a.VT)<1e-5?a.effet>0?a.e_s=a.eff_s[28]+(a.eff_s[29]-a.eff_s[28])*(a.effet/1.5):a.e_s=a.eff_s[27]+(a.eff_s[28]-a.eff_s[27])*(a.effet+1.5)/1.5:(a.effet>0?(r=a.eff_s[3*c+1]+(a.eff_s[3*c+2]-a.eff_s[3*c+1])*(a.effet/1.5),l=a.eff_s[3*(c+1)+1]+(a.eff_s[3*(c+1)+2]-a.eff_s[3*(c+1)+1])*(a.effet/1.5)):(r=a.eff_s[3*c+0]+(a.eff_s[3*c+1]-a.eff_s[3*c+0])*(a.effet+1.5)/1.5,l=a.eff_s[3*(c+1)+0]+(a.eff_s[3*(c+1)+1]-a.eff_s[3*(c+1)+0])*(a.effet+1.5)/1.5),a.e_s=r+(l-r)/10*(n-10*c)),i=(5*a.VN+2*a.VRq)/7,t=(5*a.VT-2*a.VRp)/7,a.VRr=.02*a.e_s/a.R*Math.sqrt(i*i+t*t)},this.recup_pars=function(e){a.X[e]>a.XMAX&&a.Vx[e]>0&&(a.Vx[e]=-a.VN,a.Rq[e]=-a.VRq,a.Vy[e]>0?(a.Vy[e]=a.VT,a.Rp[e]=a.VRp,a.Rr[e]=-a.VRr):(a.Vy[e]=-a.VT,a.Rp[e]=-a.VRp,a.Rr[e]=a.VRr)),a.X[e]<a.XMIN&&a.Vx[e]<0&&(a.Vx[e]=a.VN,a.Rq[e]=a.VRq,a.Vy[e]>0?(a.Vy[e]=a.VT,a.Rp[e]=a.VRp,a.Rr[e]=a.VRr):(a.Vy[e]=-a.VT,a.Rp[e]=-a.VRp,a.Rr[e]=-a.VRr)),a.Y[e]<a.YMIN&&a.Vy[e]<0&&(a.Vy[e]=a.VN,a.Rp[e]=-a.VRq,a.Vx[e]>0?(a.Vx[e]=a.VT,a.Rq[e]=-a.VRp,a.Rr[e]=-a.VRr):(a.Vx[e]=-a.VT,a.Rq[e]=a.VRp,a.Rr[e]=a.VRr)),a.Y[e]>a.YMAX&&a.Vy[e]>0&&(a.Vy[e]=-a.VN,a.Rp[e]=a.VRq,a.Vx[e]>0?(a.Vx[e]=a.VT,a.Rq[e]=-a.VRp,a.Rr[e]=a.VRr):(a.Vx[e]=-a.VT,a.Rq[e]=a.VRp,a.Rr[e]=-a.VRr))},this.init_pars=function(e){a.X[e]>a.XMAX&&a.Vx[e]>0&&(a.VN=-a.Vx[e],a.VRq=-a.Rq[e],a.Vy[e]>0?(a.VT=a.Vy[e],a.VRp=a.Rp[e],a.VRr=-a.Rr[e]):(a.VT=-a.Vy[e],a.VRp=-a.Rp[e],a.VRr=a.Rr[e])),a.X[e]<a.XMIN&&a.Vx[e]<0&&(a.VN=a.Vx[e],a.VRq=a.Rq[e],a.Vy[e]>0?(a.VT=a.Vy[e],a.VRp=a.Rp[e],a.VRr=a.Rr[e]):(a.VT=-a.Vy[e],a.VRp=-a.Rp[e],a.VRr=-a.Rr[e])),a.Y[e]<a.YMIN&&a.Vy[e]<0&&(a.VN=a.Vy[e],a.VRq=-a.Rp[e],a.Vx[e]>0?(a.VT=a.Vx[e],a.VRp=-a.Rq[e],a.VRr=-a.Rr[e]):(a.VT=-a.Vx[e],a.VRp=a.Rq[e],a.VRr=a.Rr[e])),a.Y[e]>a.YMAX&&a.Vy[e]>0&&(a.VN=-a.Vy[e],a.VRq=a.Rp[e],a.Vx[e]>0?(a.VT=a.Vx[e],a.VRp=-a.Rq[e],a.VRr=a.Rr[e]):(a.VT=-a.Vx[e],a.VRp=a.Rq[e],a.VRr=-a.Rr[e]))},this.add_clef=function(e){var t=a.nb_max_clefs*e+a.nb_clefs[e];a.evts[t]=new j,a.evts[t].X=a.X[e],a.evts[t].Y=a.Y[e],a.evts[t].RAp=a.RAp[e],a.evts[t].RAq=a.RAq[e],a.evts[t].RAr=a.RAr[e],a.evts[t].time=a.date*a.pas;var i=a.nb_clefs,n=e,s=i[e]+1;i[n]=s,a.X0[e]=a.X[e],a.Y0[e]=a.Y[e],a.RAp0[e]=a.RAp[e],a.RAq0[e]=a.RAq[e],a.RAr0[e]=a.RAr[e]},this.choc_billes=function(e){var t=0,i=0,n=!1,s=NaN,o=NaN,r=NaN,l=NaN,c=NaN,h=NaN,u=NaN,p=NaN,f=NaN,d=NaN,b=NaN,m=NaN,v=NaN,R=NaN,k=NaN,y=NaN,V=NaN,w=NaN,_=NaN,g=NaN,M=!1,x=[];for(t=0;t<3;)x[t]=!1,t++;for(t=0;t<3;){if(!x[t]&&(n=!1,i=(t+1)%3,(s=(a.X[t]-a.X[i])*(a.X[t]-a.X[i])+(a.Y[t]-a.Y[i])*(a.Y[t]-a.Y[i]))<a.D*a.D&&(a.etat[t]!=a.ARRET||a.etat[i]!=a.ARRET)&&(a.Vx[t]-a.Vx[i])*(a.X[i]-a.X[t])+(a.Vy[t]-a.Vy[i])*(a.Y[i]-a.Y[t])>0&&(n=!0,M=!0,a.choc12||a.choc13||0!=t||(a.first_bille_choquee=i),0==t&&1==i&&(a.choc12=!0),2==t&&0==i&&(a.choc13=!0),e[0]=t,e[1]=i),n||(i=(t+2)%3,(s=(a.X[t]-a.X[i])*(a.X[t]-a.X[i])+(a.Y[t]-a.Y[i])*(a.Y[t]-a.Y[i]))<a.D*a.D&&(a.etat[t]!=a.ARRET||a.etat[i]!=a.ARRET)&&(a.Vx[t]-a.Vx[i])*(a.X[i]-a.X[t])+(a.Vy[t]-a.Vy[i])*(a.Y[i]-a.Y[t])>0&&(n=!0,M=!0,a.choc12||a.choc13||0!=t||(a.first_bille_choquee=i),1==t&&0==i&&(a.choc12=!0),0==t&&2==i&&(a.choc13=!0),e[0]=t,e[1]=i)),n)){a.add_clef(t),a.add_clef(i),x[t]=!0,a.etat[t]==a.RSG&&(a.Rp[t]=-a.Vy[t],a.Rq[t]=a.Vx[t]),a.etat[t]==a.QCQ&&(a.Rp[t]=-a.Vy[t]+a.VQy[t],a.Rq[t]=a.Vx[t]-a.VQx[t]),a.etat[t]==a.ARRET&&(a.Rp[t]=0,a.Rq[t]=0),x[i]=!0,a.etat[i]==a.RSG&&(a.Rp[i]=-a.Vy[i],a.Rq[i]=a.Vx[i]),a.etat[i]==a.QCQ&&(a.Rp[i]=-a.Vy[i]+a.VQy[i],a.Rq[i]=a.Vx[i]-a.VQx[i]),a.etat[i]==a.ARRET&&(a.Rp[i]=0,a.Rq[i]=0),r=(b=a.Vx[t]*(a.X[i]-a.X[t])+a.Vy[t]*(a.Y[i]-a.Y[t]))*(a.X[i]-a.X[t])/s,l=b*(a.Y[i]-a.Y[t])/s,c=a.Vx[t]-r,h=a.Vy[t]-l,u=(m=a.Vx[i]*(a.X[t]-a.X[i])+a.Vy[i]*(a.Y[t]-a.Y[i]))*(a.X[t]-a.X[i])/s,p=m*(a.Y[t]-a.Y[i])/s,f=a.Vx[i]-u,d=a.Vy[i]-p,R=r-u,k=l-p,a.intens=(R*R+k*k)/5,a.intens>1&&(a.intens=1),a.evts_son[a.nb_sons]=new N,a.evts_son[a.nb_sons].played=!1,a.evts_son[a.nb_sons].temps=a.date*a.pas,a.evts_son[a.nb_sons].intensite=a.intens,a.evts_son[a.nb_sons].type_choc=2;var S=a,A=a.nb_sons+1;S.nb_sons=A,v=r,r=u,u=v,u*=a.RendementChoc,r*=a.RendementChoc,v=l,l=p,p=v,p*=a.RendementChoc,l*=a.RendementChoc,a.Vx[t]=r+c,a.Vy[t]=l+h,a.VQx[t]=a.Vx[t]-a.Rq[t],a.VQy[t]=a.Vy[t]+a.Rp[t],a.etat[i]==a.ARRET&&(a.Vx[i]=.94*a.Vx[i],a.Vy[i]=.94*a.Vy[i],b/=o=Math.sqrt(s),b=Math.abs(b),_=a.fbille*b,y=Math.abs(a.Rp[t]*(a.Y[i]-a.Y[t])-a.Rq[t]*(a.X[i]-a.X[t]))/o,w=(a.Vx[t]*(a.Y[i]-a.Y[t])-a.Vy[t]*(a.X[i]-a.X[t]))/o-a.Rr[t],V=Math.abs(w)<1e-5?Math.PI/2:Math.abs(Math.atan(y/w)),g=(w>0?1:-1)*_*Math.cos(V),a.Rr[i]=2.5*g,a.Rr[t]=a.Rr[t]-2.5*g,f=g*(a.Y[i]-a.Y[t])/o,d=-g*(a.X[i]-a.X[t])/o),a.Vx[i]=u+f,a.Vy[i]=p+d,a.VQx[i]=a.Vx[i]-a.Rq[i],a.VQy[i]=a.Vy[i]+a.Rp[i],a.etat[i]=a.QCQ,a.etat[t]=a.QCQ}t++}return M};this.XMAX=t,this.YMAX=i,this.XMIN=-t,this.YMIN=-i,this.nb_max_clefs=1e4,this.nb_clefs=[];this.nb_clefs[2]=0,this.nb_clefs[1]=0,this.nb_clefs[0]=0,this.evts=[],this.nb_max_sons=50,this.nb_sons=0,this.evts_son=[],this.sorties=[],this.eff_s=[],this.etat=[],this.X0=[],this.Y0=[],this.X=[],this.Y=[],this.Xfin=[],this.Yfin=[],this.RAp=[],this.RAq=[],this.RAr=[],this.RAp0=[],this.RAq0=[],this.RAr0=[],this.RApfin=[],this.RAqfin=[],this.RArfin=[],this.Vx=[],this.Vy=[],this.Rp=[],this.Rq=[],this.Rr=[],this.VQx=[],this.VQy=[],this.etat=[],this.D=.06,this.R=.03,this.RendementChoc=.8,this.deltaclefRot=this.R*Math.PI/10,this.resolution=.01,this.done=!1,this.sorties[0]=0,this.sorties[1]=0,this.sorties[2]=0,this.sorties[3]=7.5,this.sorties[4]=7.5,this.sorties[5]=7.5,this.sorties[6]=16,this.sorties[7]=16,this.sorties[8]=16,this.sorties[9]=33,this.sorties[10]=32,this.sorties[11]=23.5,this.sorties[12]=52,this.sorties[13]=43,this.sorties[14]=31,this.sorties[15]=72,this.sorties[16]=53,this.sorties[17]=35,this.sorties[18]=86,this.sorties[19]=60,this.sorties[20]=38,this.sorties[21]=100,this.sorties[22]=69,this.sorties[23]=44,this.sorties[24]=108,this.sorties[25]=79,this.sorties[26]=53,this.sorties[27]=120,this.sorties[28]=90,this.sorties[29]=60,this.eff_s[0]=-1.5,this.eff_s[1]=0,this.eff_s[2]=1.5,this.eff_s[3]=-1.5,this.eff_s[4]=.5,this.eff_s[5]=1.2,this.eff_s[6]=-1.3,this.eff_s[7]=.7,this.eff_s[8]=1.3,this.eff_s[9]=-.5,this.eff_s[10]=1.3,this.eff_s[11]=1.2,this.eff_s[12]=-.5,this.eff_s[13]=1.3,this.eff_s[14]=1.1,this.eff_s[15]=-.3,this.eff_s[16]=.8,this.eff_s[17]=1.2,this.eff_s[18]=0,this.eff_s[19]=.7,this.eff_s[20]=1.2,this.eff_s[21]=0,this.eff_s[22]=.5,this.eff_s[23]=1.5,this.eff_s[24]=-.6,this.eff_s[25]=.2,this.eff_s[26]=1.5,this.eff_s[27]=-.65,this.eff_s[28]=0,this.eff_s[29]=1.5},Y=function e(t,i){var a=this;Object(r.a)(this,e),this.RApInit=[],this.RArInit=[],this.RAqInit=[],this.Xinit=[],this.Yinit=[],this.HBande=.035,this.direction_beta=function(e,t,i){var n,s,o;return o=Math.sqrt((a.Xinit[0]-t)*(a.Xinit[0]-t)+(a.Yinit[0]-i)*(a.Yinit[0]-i)),e*=.06,n=Math.asin(e/o),(s=a.atanjimi(i-a.Yinit[0],t-a.Xinit[0]))-n>Math.PI?s-n-2*Math.PI:s-n<-Math.PI?s-n+2*Math.PI:s-n},this.ToucheBandeX=function(e){for(var t,i,n,s,o,r,l,c,h,u,p,f,d,b=NaN,m=NaN;a.betaQ<0;)a.betaQ=a.betaQ+2*Math.PI;for(;a.betaQ>=2*Math.PI;)a.betaQ=a.betaQ-2*Math.PI;return u=a.betaQ,h=e,m=Math.cos(u),d=Math.sin(u),p=Math.cos(h),f=Math.sin(h),o=((c=Math.sqrt(9e-4-a.er*a.er-a.el*a.el))*p-a.er*f)*m-a.el*d,r=c*f+a.er*p,l=(c*p-a.er*f)*d+a.el*m,b=a.Xinit[0]+o,t=.03+r,a.Yinit[0]+l,n=a.long_billard/2,!(Math.abs(m)<1e-5)&&(u>Math.PI/2&&u<3*Math.PI/2&&(m=-m,b=-b),!((s=(n-b)/m)>1.4)&&(i=.006+.009/1.4*s/p,!(s*f/p+t>a.HBande+i/p)))},this.atanjimi=function(e,t){var i;return Math.abs(t)<1e-6?e>0?Math.PI/2:-Math.PI/2:(i=Math.atan(e/t),t>0?i:e<0?i-Math.PI:i+Math.PI)},this.Quantite=function(){var e,t=0,i=[],n=[];for(e=a.betaQ+Math.PI,t=1;t<a.NBILLES;)i[t]=!1,(a.Xinit[t]-a.Xinit[0])*Math.cos(e)+(a.Yinit[t]-a.Yinit[0])*Math.sin(e)>0&&(n[t]=(a.Yinit[t]-a.Yinit[0])*Math.cos(e)-(a.Xinit[t]-a.Xinit[0])*Math.sin(e),n[t]<.06&&n[t]>-.06&&(i[t]=!0)),t++;a.bille_visee=-1;var s=100;for(t=1;t<a.NBILLES;)i[t]&&(a.Xinit[t]-a.Xinit[0])*(a.Xinit[t]-a.Xinit[0])+(a.Yinit[t]-a.Yinit[0])*(a.Yinit[t]-a.Yinit[0])<s&&(a.bille_visee=t,s=(a.Xinit[t]-a.Xinit[0])*(a.Xinit[t]-a.Xinit[0])+(a.Yinit[t]-a.Yinit[0])*(a.Yinit[t]-a.Yinit[0])),t++;return-1!=a.bille_visee?(a.noba=!0,a.quant=n[a.bille_visee]/2/.03):(a.noba=!1,a.quant=0),a.quant},this.ToucheBandeZ=function(e){for(var t,i,n,s,o,r,l,c,h,u,p,f,d,b=NaN,m=NaN;a.betaQ<0;)a.betaQ=a.betaQ+2*Math.PI;for(;a.betaQ>=2*Math.PI;)a.betaQ=a.betaQ-2*Math.PI;return u=a.betaQ,h=e,d=Math.cos(u),m=Math.sin(u),p=Math.cos(h),f=Math.sin(h),o=((c=Math.sqrt(9e-4-a.er*a.er-a.el*a.el))*p-a.er*f)*d-a.el*m,r=c*f+a.er*p,l=(c*p-a.er*f)*m+a.el*d,a.Xinit[0]+o,t=.03+r,b=a.Yinit[0]+l,n=a.larg_billard/2,!(Math.abs(m)<1e-5)&&(u>Math.PI&&(m=-m,b=-b),!((s=(n-b)/m)>1.4)&&(i=.006+.009/1.4*s/p,!(s*f/p+t>a.HBande+i/p)))},this.AlphaQmin=function(){for(var e=0;a.ToucheBandeZ(e)||a.ToucheBandeX(e)||a.ToucheBille(e);)e+=Math.PI/90;return e},this.ToucheBille=function(e){var t=NaN,i=NaN,n=NaN,s=NaN,o=NaN,r=NaN,l=NaN,c=NaN,h=NaN,u=NaN,p=NaN,f=0,d=e,b=a.betaQ;for(f=1;f<a.NBILLES;){for(t=a.Xinit[0]+.032*Math.cos(b)*Math.cos(d)-a.el*Math.sin(b)-a.er*Math.sin(d)*Math.cos(b),i=.03+.032*Math.sin(d)+a.er*Math.cos(d),n=a.Yinit[0]+.032*Math.sin(b)*Math.cos(d)+a.el*Math.cos(b)-a.er*Math.sin(d)*Math.sin(b),r=a.Xinit[f],l=.03,c=a.Yinit[f],o=0;o<1.4;){if(s=.006+.009/1.4*o,((h=t+o*Math.cos(d)*Math.cos(b))-r)*(h-r)+((u=i+o*Math.sin(d))-l)*(u-l)+((p=n+o*Math.cos(d)*Math.sin(b))-c)*(p-c)<(.03+s+.002)*(.03+s+.002))return!0;o+=.01}f++}return!1};var n=0;for(this.NBILLES=3,this.long_billard=t,this.larg_billard=i,this.Xinit=[],this.Yinit=[],this.RApInit=[],this.RAqInit=[],this.RArInit=[],n=0;n<3;)this.RApInit[n]=0,this.RAqInit[n]=0,this.RArInit[n]=0,n++;this.Xinit[0]=-.71,this.Yinit[0]=-.1775,this.Xinit[1]=-.71,this.Yinit[1]=0,this.Xinit[2]=.71,this.Yinit[2]=0,this.Vqueue=.08,this.el=0,this.er=.012,this.alphaQ=0,this.betaQ=0*Math.PI/4,this.Vqueue=3.19731,this.el=.0056,this.er=.004,this.alphaQ=.033916,this.betaQ=3.28339,this.Xinit[0]=0,this.Yinit[0]=0,this.Xinit[1]=-.051,this.Yinit[1]=.05,this.Xinit[2]=.05,this.Yinit[2]=.05,this.Vqueue=.4,this.el=0,this.er=0,this.alphaQ=.033916,this.betaQ=-7*Math.PI/8},B=function e(t,i,a,n){var s=this;Object(r.a)(this,e),this.mode_jeu=2,this.ralenti=1,this.largeur_bandes=.28,this.change_billard=function(e){if(s.arret_son(),s.myTimer.stop(),1==e){s.taille(280);var t=!1;s.bitmap_Bandes_310.visible=!1,s.bitmap_Billard_310.visible=t;t=!0;s.bitmap_Bandes_280.visible=!0,s.bitmap_Billard_280.visible=t;t=!1;s.bitmap_Bandes_260.visible=!1,s.bitmap_Billard_260.visible=t}else if(2==e){s.taille(260);t=!1;s.bitmap_Bandes_310.visible=!1,s.bitmap_Billard_310.visible=t;t=!1;s.bitmap_Bandes_280.visible=!1,s.bitmap_Billard_280.visible=t;t=!0;s.bitmap_Bandes_260.visible=!0,s.bitmap_Billard_260.visible=t}else if(0==e){s.taille(310);t=!0;s.bitmap_Bandes_310.visible=!0,s.bitmap_Billard_310.visible=t;t=!1;s.bitmap_Bandes_280.visible=!1,s.bitmap_Billard_280.visible=t;t=!1;s.bitmap_Bandes_260.visible=!1,s.bitmap_Billard_260.visible=t}s.ctrl.XC=s.Ech*s.longueur/2,s.ctrl.YC=s.Ech*s.largeur/2,s.Params.long_billard=2*(s.xmax+s.R),s.Params.larg_billard=2*(s.ymax+s.R),null!=s.Simulateur&&(s.Simulateur.XMAX=s.xmax,s.Simulateur.YMAX=s.ymax,s.Simulateur.XMIN=-s.xmax,s.Simulateur.YMIN=-s.ymax),s.tracer_grille(),s.tracer_lines(),s.Placer_billes_hasard(),s.Params.Vqueue=1,s.init_point()},this.arret_son=function(){},this.init_point=function(){s.arret_son(),s.myTimer.stop(),s.afficher_billes(),s.ctrl.aff_parametres(),s.placer_queue(s.dq0),s.queue.visible=!0,s.calculs_faits=!1,s.aff_trajets=!1,s.trajets.graphics.clear(),s.tracer_ligne_visee(),s.ligne_visee.visible=!0},this.update_modejeu=function(e){s.mode_jeu=e,s.arret_son(),0==e&&(s.Vqmax=3.5),1==e&&(s.Vqmax=3.5),2==e&&(s.Vqmax=4.2),3==e&&(s.Vqmax=3.5),4==e&&(s.Vqmax=3.5),5==e&&(s.Vqmax=5.4)},this.Simuler=function(e,t){return s.ralenti=e,s.arret_son(),s.Simulateur.Calcul(t)},this.taille=function(e){s.taille_billard=e,310==e&&(s.longueur=3.12),280==e&&(s.longueur=2.82),260==e&&(s.longueur=2.62),s.xmax=(s.longueur-s.largeur_bandes)/2-.03,s.ymax=(s.longueur-s.largeur_bandes)/4-.03,s.largeur=2*(s.ymax+.03)+s.largeur_bandes};var o=0;this.Ech=a,this.R=.03,this.Rb=36,this.type=0,this.taille(t),this.Params=new Y(2*(this.xmax+this.R),2*(this.ymax+this.R));for(this.ombre=[],this.aff_trajets=!1,this.tous_trajets=!0,this.trajet_bille_joueur=!1,this.trajet_bille_visee=!1,this.billes=[],this.bille_visee=1,this.ecl=[],this.dq0=1.5*this.R*this.Ech,this.alphamin=!0,this.Vqmax=3.5,this.Simulateur=new C(this.xmax,this.ymax),this.ind_last_clef=[],o=0;o<3;)this.ind_last_clef[o]=this.Simulateur.nb_max_clefs*o,o++;for(this.calculs_faits=!1,this.ampl_recul_max=.1,this.RAp0=[],this.RAq0=[],this.RAr0=[],o=0;o<3;)this.RAp0[o]=0,this.RAq0[o]=0,this.RAr0[o]=0,o++;this.alphamin=!1,console.log(this)},P=function(){function e(t,i,a,n,s){var o=this;Object(r.a)(this,e),this.drawBallPath=function(e){var t=o.pathData;if(t&&0!=t.length&&(o.pathCueWhite&&o.pathCueWhite.dispose(),o.pathCueYellow&&o.pathCueYellow.dispose(),o.pathTargetBall&&o.pathTargetBall.dispose(),e)){for(var i=[],a=0;a<1e4;a++)t[a]&&i.push(new f.Vector3(m*t[a].X/o.size,o.ballRadius/2,m*t[a].Y/o.size));o.pathCueWhite=f.MeshBuilder.CreateLines("lines",{points:i},o.scene);var n=[],s=[];for(a=1e4;a<2e4;a++)t[a]&&(n.push(new f.Vector3(m*t[a].X/o.size,o.ballRadius/2,m*t[a].Y/o.size)),s.push(new f.Color4(.8,.8,0,1)));o.pathCueYellow=f.MeshBuilder.CreateLines("lines",{points:n,colors:s},o.scene);var r=[],l=[];for(a=2e4;a<3e4;a++)t[a]&&(r.push(new f.Vector3(m*t[a].X/o.size,o.ballRadius/2,m*t[a].Y/o.size)),l.push(new f.Color4(.8,0,0,1)));o.pathTargetBall=f.MeshBuilder.CreateLines("lines",{points:r,colors:l},o.scene)}},this.configCameras=function(){var e=o;e.cameras.arcCam=new f.ArcRotateCamera("Camera-Arc",4.44,1.05,300,f.Vector3.Zero(),e.scene),e.cameras.arcCam.attachControl(e.canvas),e.cameras.arcCam.upperBetaLimit=1.5,e.cameras.arcCam.wheelPrecision=.2,e.cameras.arcCam.upperRadiusLimit=500,e.cameras.arcCam.lowerRadiusLimit=100,e.cameras.topCam=new f.ArcRotateCamera("Camera-Top",-Math.PI/2,0,330,f.Vector3.Zero(),e.scene),e.cameras.topCam.upperBetaLimit=0,e.cameras.topCam.lowerBetaLimit=0,e.cameras.topCam.upperAlphaLimit=-Math.PI/2,e.cameras.topCam.lowerAlphaLimit=-Math.PI/2,e.cameras.topCam.upperRadiusLimit=330,e.cameras.topCam.lowerRadiusLimit=330,e.cameras.topCam.mode=f.Camera.ORTHOGRAPHIC_CAMERA,e.cameras.topCam.orthoTop=130,e.cameras.topCam.orthoBottom=-130,e.cameras.topCam.orthoLeft=-240,e.cameras.topCam.orthoRight=240,e.changeView(e.currentView)},this.loadModels=function(){var e=o,t=o.modelStorePath;f.SceneLoader.ImportMesh("",t,b,e.scene,function(i){e.objects.bat=i[0],e.objects.bat.position.y=50,e.objects.bat.position.z=90,e.objects.batLookatPoint=new f.MeshBuilder.CreateSphere("look-at",{diameter:4},e.scene),e.objects.batLookatPoint.position.y=30,e.objects.batLookatPoint.visibility=!1,f.SceneLoader.ImportMesh("",t,d,e.scene,function(i){e.objects.table=i;var a=!0,n=!1,s=void 0;try{for(var o,r=i[Symbol.iterator]();!(a=(o=r.next()).done);a=!0){var l=o.value;"carpet"===l.name&&(l.material.bumpTexture=new f.Texture(t+"carpet-bump.png",e.scene))}}catch(c){n=!0,s=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw s}}e.configCueBalls(),e.updateBat(e.controlOptions)})})},this.updateControlOptions=function(e){o.controlOptions=e,o.updateBat(e)},this.updateBat=function(e){var t=e.cueLine,i=e.cueAngle,a=e.sideEnglish,n=e.topSpin,s=o.size,r=o.ballRadius,l=o.objects,c=l.bat,h=l.batLookatPoint,u=l.directionLine,p=l.cueBallWhite,d=m*a/s,b=m*n/s;c.position.x=p.position.x-d*Math.sin(t)-b*Math.sin(i)*Math.cos(t),c.position.z=p.position.z+d*Math.cos(t)-b*Math.sin(i)*Math.sin(t),c.position.y=r/2+b*Math.cos(i),c.rotation=new f.Vector3(0,-t,Math.PI/2+i);var v=Object.assign({},c.position);v.y+=40*Math.sin(i),v.x+=40*Math.cos(i)*Math.cos(t),v.z+=40*Math.cos(i)*Math.sin(t),h.position=v,h.lookAt(c.position),u.position.x=p.position.x,u.position.z=p.position.z,u.position.y=r/2,u.rotation.y=Math.PI-t},this.generateReflectionMaterial=function(e,t){for(var i=o.scene,a=new f.ReflectionProbe("satelliteProbe"+e.name,512,i),n=0;n<t.length;n++)a.renderList.push(t[n]);e.material.reflectionTexture=a.cubeTexture,e.material.reflectivityColor=new f.Color3(.2,.2,.2),e.material.reflectionFresnelParameters=new f.FresnelParameters,e.material.reflectionFresnelParameters.bias=0,a.attachToMesh(e)},this.configCueBalls=function(){var e,t,i=o,a=o.modelStorePath,n=o.ballRadius,s=o.objects.table,r=(o.cameras.arcCam,!0),l=!1,c=void 0;try{for(var h,u=s[Symbol.iterator]();!(r=(h=u.next()).done);r=!0){var p=h.value;"carpet"===p.name?e=p:"carpet-side"===p.name&&(t=p)}}catch(w){l=!0,c=w}finally{try{r||null==u.return||u.return()}finally{if(l)throw c}}var d=o.ballPositions,b=d.posCueBallWhite,m=d.posCueBallYellow,v=d.posTargetBall;i.objects.cueBallWhite=f.Mesh.CreateSphere("cue-ball-white",16,n,i.scene),i.objects.cueBallWhite.position.y=n/2,i.objects.cueBallWhite.position.x=b.x,i.objects.cueBallWhite.position.z=b.z;var R=new f.StandardMaterial("redMat",i.scene);R.diffuseTexture=new f.Texture(a+"cueball-white.jpg",i.scene),i.objects.cueBallWhite.material=R,i.objects.cueBallYellow=f.Mesh.CreateSphere("cue-ball-yellow",16,n,i.scene),i.objects.cueBallYellow.position.y=n/2,i.objects.cueBallYellow.position.x=m.x,i.objects.cueBallYellow.position.z=m.z;var k=new f.StandardMaterial("redMat",i.scene);k.diffuseTexture=new f.Texture(a+"cueball-yellow.jpg",i.scene),i.objects.cueBallYellow.material=k,i.objects.targetBall=f.Mesh.CreateSphere("cue-ball-red",16,n,i.scene),i.objects.targetBall.position.y=n/2,i.objects.targetBall.position.x=v.x,i.objects.targetBall.position.z=v.z;var y=new f.StandardMaterial("redMat",i.scene);y.diffuseTexture=new f.Texture(a+"targetball.jpg",i.scene),i.objects.targetBall.material=y,i.generateReflectionMaterial(i.objects.cueBallWhite,[i.objects.cueBallYellow,i.objects.targetBall,i.objects.bat,e,t]),i.generateReflectionMaterial(i.objects.cueBallYellow,[i.objects.cueBallWhite,i.objects.targetBall,i.objects.bat,e,t]),i.generateReflectionMaterial(i.objects.targetBall,[i.objects.cueBallWhite,i.objects.cueBallYellow,i.objects.bat,e,t]),i.objects.ray=new f.Ray,i.objects.rayHelper=new f.RayHelper(i.objects.ray);var V=new f.Vector3(0,0,1);i.objects.rayHelper.attachToMesh(i.objects.batLookatPoint,V)},this.configGrids=function(){for(var e=o,t=[new f.Color4(.7,.7,.7,1),new f.Color4(.7,.7,.7,1)],i=0;i<15;i++){var a=[new f.Vector3(7*-m/16+i*m/16,2,-m/4),new f.Vector3(7*-m/16+i*m/16,2,m/4)];e.grids.push(f.MeshBuilder.CreateLines("lines",{points:a,colors:t},e.scene))}for(i=0;i<7;i++){var n=[new f.Vector3(-m/2,2,3*-m/16+i*m/16),new f.Vector3(m/2,2,3*-m/16+i*m/16)];e.grids.push(f.MeshBuilder.CreateLines("lines",{points:n,colors:t},e.scene))}},this.toggleGrids=function(e){for(var t=o.grids,i=0;i<t.length;i++)t[i].visibility=e},this.initializeScene=function(e,t){var i=o;i.scene=e,i.canvas=t,i.scene.clearColor=new f.Color3(.05,.05,.05),i.objects.directionLine=new f.MeshBuilder.CreateLines("direction-line",{points:[new f.Vector3(0,0,0),new f.Vector3(600,0,0)],colors:[new f.Color4(0,0,.8,1),new f.Color4(0,0,.8,1)]}),new f.HemisphericLight("light",f.Vector3.Up(),e),i.configCameras(),i.loadModels(),i.configGrids(),i.scene.getEngine().runRenderLoop(function(){e&&(e.render(),i.animateBalls())}),t.addEventListener("pointerdown",i.onPointerDown,!1),t.addEventListener("pointerup",i.onPointerUp,!1),t.addEventListener("pointermove",i.onPointerMove,!1)},this.getGroundPosition=function(){var e=o.scene,t=e.pick(e.pointerX,e.pointerY,function(e){return"carpet"==e.name});return t.hit?t.pickedPoint:null},this.onPointerDown=function(e){var t=o,i=o.scene,a=o.canvas;if(0===e.button){var n=i.pick(i.pointerX,i.pointerY,function(e){return"cue-ball-white"===e.name||"cue-ball-yellow"===e.name||"cue-ball-red"===e.name});n.hit&&(t.currentMesh=n.pickedMesh,t.startingPoint=t.getGroundPosition(e),t.startingPoint&&setTimeout(function(){t.cameras.arcCam.detachControl(a)},0))}},this.onPointerUp=function(){var e=o,t=o.startingPoint,i=o.canvas;if(t)return e.cameras.arcCam.attachControl(i,!0),e.startingPoint=null,void(e.currentMesh=null)},this.onPointerMove=function(e){var t=o,i=o.startingPoint,a=o.currentMesh;if(i){var n=t.getGroundPosition(e);n&&(a.position=n,a.position.y=t.ballRadius/2,i=n,t.updateBat(t.controlOptions))}},this.moveAndRotateBall=function(e,t,i){var a,n=-1,s=o;for(a=1e4*i;a<1e4*(i+1)&&s.pathData[a];a++)s.pathData[a].time<t-s.t0&&(n=a);if(n>=0){if(n==a-1)return!1;var r=s.pathData[n];e.position.x=m*r.X/s.size,e.position.z=m*r.Y/s.size;var l=s.pathData[n].RAp,c=s.pathData[n].RAq,h=s.pathData[n].RAr,u=(l-s.RAp0[i])/.03,p=(c-s.RAq0[i])/.03,d=(h-s.RAr0[i])/.03;return s.RAp0[i]=l,s.RAq0[i]=c,s.RAr0[i]=h,e.rotate(f.Axis.X,-u,f.Space.WORLD),e.rotate(f.Axis.Y,-d,f.Space.WORLD),e.rotate(f.Axis.Z,-p,f.Space.WORLD),!0}},this.animateBalls=function(){var e=o,t=o.objects,i=t.cueBallWhite,a=t.cueBallYellow,n=t.targetBall;if(e.pathData&&0!=e.pathData.length&&void 0!=e.t0){var s=(new Date).getTime()/1e3,r=o.moveAndRotateBall(i,s,0),l=o.moveAndRotateBall(a,s,1),c=o.moveAndRotateBall(n,s,2);console.log(r,l,c),0==r&&0==l&&0==c&&(e.pathData=[])}},this.playSimulation=function(){var e=o,t=(o.initBallPosition,o.controlOptions),i=o.objects,a=i.cueBallWhite,n=i.cueBallYellow,s=i.targetBall,r=o.billard.Simuler(1,{Xinit:[e.size*a.position.x/m,e.size*n.position.x/m,e.size*s.position.x/m],Yinit:[e.size*a.position.z/m,e.size*n.position.z/m,e.size*s.position.z/m],RApInit:[0,0,0],RAqInit:[0,0,0],RArInit:[0,0,0],el:t.sideEnglish,er:t.topSpin,alphaQ:t.cueAngle,betaQ:t.cueLine,Vqueue:t.speed});console.log(r),r&&0!=r.length&&(o.pathData=r,o.t0=(new Date).getTime()/1e3)},this.scene=void 0,this.canvas=void 0,this.size=t,this.ballRadius=400*v/(100*this.size),this.modelStorePath=i,this.initBallPosition=n,this.ballPositions={posCueBallWhite:{x:m*n.posCueBallWhite.x/t,z:m*n.posCueBallWhite.z/t},posCueBallYellow:{x:m*n.posCueBallYellow.x/t,z:m*n.posCueBallYellow.z/t},posTargetBall:{x:m*n.posTargetBall.x/t,z:m*n.posTargetBall.z/t}},this.currentView=a,this.cameras={arcCam:void 0,topCam:void 0},this.objects={table:void 0,bat:void 0,cueBallWhite:void 0,cueBallYellow:void 0,targetBall:void 0,batContactLine:void 0,batLookatPoint:void 0,directionLine:void 0},this.controlOptions=s,this.grids=[],this.pathCueWhite=void 0,this.pathCueYellow=void 0,this.pathTargetBall=void 0,this.billard=new B(310,void 0,300),this.timerCount=0,this.RAp0=[0,0,0],this.RAq0=[0,0,0],this.RAr0=[0,0,0]}return Object(l.a)(e,[{key:"changeView",value:function(e){"2d"===e?(this.scene.activeCamera=this.cameras.topCam,this.cameras.arcCam.detachControl(this.canvas),this.cameras.topCam.attachControl(this.canvas)):(this.scene.activeCamera=this.cameras.arcCam,this.cameras.arcCam.attachControl(this.canvas),this.cameras.topCam.detachControl(this.canvas))}}]),e}(),X=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,[{key:"applyToController",value:function(e){}}]),e}(),O={BEGIN:0,WATCHAIM:1,AIM:2,HIT:3,STATIONARY:4,CHAT:5,ABORT:6,REPOSITION:7},T=i(0),I=new T.r(0,0,0),q=new T.r(0,0,1);function E(e){return new T.r(e.x,e.y,e.z)}function z(e){return q.clone().cross(e)}function Q(e){return e.clone().normalize()}function W(e,t){return e.clone().add(t).dot(e)<=0}var L=function(){function e(){Object(r.a)(this,e),this.pos=new T.r(1,0,0),this.dir=new T.r(1,0,0),this.verticalOffset=0,this.sideOffset=0,this.angle=0,this.power=0}return Object(l.a)(e,[{key:"applyToController",value:function(e){return e.handleAim(this)}},{key:"copy",value:function(){return e.fromJson(this)}}],[{key:"fromJson",value:function(t){var i=new e;return i.pos=E(t.pos),i.dir=E(t.dir),i.angle=t.angle,i.verticalOffset=t.verticalOffset,i.sideOffset=t.sideOffset,i.power=t.power,i}}]),e}(),D=function e(t,i){Object(r.a)(this,e),this.t=t,this.key=i},F=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(h.a)(t).call(this))).type=O.STATIONARY,e}return Object(u.a)(t,e),Object(l.a)(t,[{key:"applyToController",value:function(e){return e.handleStationary(this)}}],[{key:"fromJson",value:function(e){return new t}}]),t}(X),G=.006,H=9.8,K=.1,Z=G*K*H*2/3*.4,U=7/(5*Math.sqrt(2))*G*K*H,J=.8;function $(e,t){return e.clone().add(z(t)).setZ(0)}var ee=Math.sin(9.25/32.5),te=Math.cos(9.25/32.5),ie=ee*ee,ae=te*te;function ne(e,t){return new T.r(e.x*ee-e.z*te+t.y,-e.y-t.z*te+t.x*ee)}function se(e){return e.x*te-e.z*te}var oe=7/(2*K),re=1/K;function le(e,t,i,a){i.set(-e.x*(2/7*ie+(1+J)*ae)-2/7*t.y*ee,5/7*e.y+2/7*(t.x*ee-t.z*te)-e.y,0);var n=ne(e,t),s=5*n.y/(2*K*oe);a.set(s*ee,5/(2*K)*(-n.x/oe+ee*se(e)*(1+J)/re*(te-ee)),s*te)}var ce=function(){function e(){Object(r.a)(this,e),this.scene=void 0,this.lineColor=[16777215,16711680,65280,16776960,65535,16711935][parseInt(1e3*Math.random())%6],this.initialiseMesh(),this.current={x:0,y:0,z:0},this.t0=(new Date).getTime()}return Object(l.a)(e,[{key:"updatePosition",value:function(e){var t=this.mesh.position;if(t.x!=e.x||t.y!=e.y||t.z!=e.z){var i=(new Date).getTime();if(console.log(i-this.t0),i-this.t0>=.005){this.t0=i;var a=new T.i({color:this.lineColor,linewidth:10}),n=new T.f;n.vertices.push(Object.assign({},t),Object.assign({},e));var s=new T.h(n,a);this.mesh.parent.add(s)}}this.mesh.position.copy(e)}},{key:"updateRotation",value:function(e,t){var i=e.length()*t*Math.PI/2,a=(new T.k).identity().makeRotationAxis(Q(e),i);this.mesh.geometry.applyMatrix(a),this.arrow.setDirection(Q(e)),this.arrow.position.copy(this.mesh.position),this.arrow.setLength(1*e.length()+.4)}},{key:"initialiseMesh",value:function(){var e=new T.g(.5,1),t=new T.m({color:this.lineColor,emissive:.4});this.mesh=new T.l(e,t),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.name="ball",this.arrow=new T.b(q,I,2,13369344)}},{key:"addToScene",value:function(e){console.log("add to scene",e),e.add(this.mesh),e.add(this.arrow)}}]),e}(),he={Stationary:"Stationary",Rolling:"Rolling",Sliding:"Sliding",Falling:"Falling",InPocket:"InPocket"},ue=function(){function e(t){Object(r.a)(this,e),this.vel=I.clone(),this.rvel=I.clone(),this.state=he.Stationary,this.transition=.05,this.pos=t.clone(),this.mesh=new ce}return Object(l.a)(e,[{key:"update",value:function(e){this.updatePosition(e),this.updateVelocity(e),this.mesh.updateRotation(this.rvel,e)}},{key:"updatePosition",value:function(e){this.pos.addScaledVector(this.vel,e),this.mesh.updatePosition(this.pos)}},{key:"updateVelocity",value:function(e){this.inMotion()&&(this.isRolling()?this.updateVelocityRolling(e):this.updateVelocitySliding(e))}},{key:"updateVelocityRolling",value:function(e){var t,i;t=this.vel,i=this.rvel,t.sub($(t,i).multiplyScalar(.5)),i.copy(z(t));var a=new T.r,n=new T.r;!function(e,t,i){var a=new T.r(e.x,e.y,0).length(),n=5/7*U/a;t.set(-n*e.y,n*e.x,0),i.set(-n*e.x,-n*e.y,-n*e.z)}(this.rvel,a,n),a.multiplyScalar(e),n.multiplyScalar(e),W(this.rvel,n)||W(this.vel,a)?this.setStationary():(this.vel.add(a),this.rvel.add(n),this.state=he.Rolling)}},{key:"updateVelocitySliding",value:function(e){var t=new T.r,i=new T.r;!function(e,t,i,a){var n=$(e,t);i.copy(Q(n).multiplyScalar(-G*H)),a.copy(Q(z(n)).multiplyScalar(2.5*G*H)),a.setZ(-2.5*Z*Math.sign(t.z))}(this.vel,this.rvel,t,i),t.multiplyScalar(e),i.multiplyScalar(e),W(this.rvel,i)&&W(this.vel,t)?this.setStationary():(this.vel.add(t),this.rvel.add(i),this.state=he.Sliding)}},{key:"setStationary",value:function(){this.vel.copy(I),this.rvel.copy(I),this.state=he.Stationary}},{key:"isRolling",value:function(){return $(this.vel,this.rvel).length()<this.transition&&0!=this.vel.length()}},{key:"onTable",value:function(){return this.state!=he.Falling}},{key:"inMotion",value:function(){return this.onTable()&&(0!=this.vel.length()||0!=this.rvel.length())}},{key:"futurePosition",value:function(e){return this.pos.clone().addScaledVector(this.vel,e)}},{key:"serialise",value:function(){return{pos:this.pos,vel:this.vel,rvel:this.rvel,state:this.state}}}],[{key:"fromSerialised",value:function(t){return e.updateFromSerialised(new e(E(t.pos)),t)}},{key:"updateFromSerialised",value:function(e,t){return e.pos.copy(t.pos),e.vel.copy(E(t.vel)),e.rvel.copy(E(t.rvel)),e.state=t.state,e}}]),e}(),pe=function(){function e(t,i){Object(r.a)(this,e),this.pos=t,this.radius=i}return Object(l.a)(e,[{key:"bounce",value:function(e){var t=e.pos.clone().sub(this.pos).normalize(),i=t.dot(e.vel);e.vel.addScaledVector(t,-2*be.elasticity*i)}}],[{key:"willBounce",value:function(e,t){return t.distanceTo(e.pos)<.5+e.radius}},{key:"willBounceAny",value:function(t,i){var a=t.futurePosition(i);return t.onTable()&&de.knuckles.find(function(t){return e.willBounce(t,a)})}}]),e}(),fe=function(){function e(t,i){Object(r.a)(this,e),this.pos=t,this.radius=i}return Object(l.a)(e,[{key:"fall",value:function(e,t){var i=e.pos.clone().sub(this.pos).normalize();e.vel.addScaledVector(i,1*t),e.vel.z=-1,e.state=he.Falling}}],[{key:"willFall",value:function(e,t){return t.distanceTo(e.pos)<.5+e.radius}},{key:"willFallAny",value:function(t,i){var a=t.futurePosition(i);return t.onTable()&&de.pocketCenters.find(function(t){return e.willFall(t,a)})}}]),e}(),de=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"addToScene",value:function(t){e.addCushions(t)}},{key:"pocketCylinder",value:function(t,i){e.cylinder(t.pos.clone().setZ(-.5),t.radius,.1,i)}},{key:"cylinder",value:function(t,i,a,n){var s=new T.d(i,i,a,16),o=new T.l(s,e.material);return o.position.copy(t),o.geometry.applyMatrix((new T.k).identity().makeRotationAxis(new T.r(1,0,0),Math.PI/2)),n.add(o),o}},{key:"addPockets",value:function(t){e.pocketCenters.forEach(function(i){return e.pocketCylinder(i,t)})}},{key:"addCushions",value:function(t){e.plane(new T.r(0,0,-6.5),2*e.X,2*e.Y,12,t);var i=.75,a=-.125,n=Math.abs(e.pockets.pocketNW.knuckleNE.pos.x-e.pockets.pocketN.knuckleNW.pos.x),s=Math.abs(e.pockets.pocketNW.knuckleSW.pos.y-e.pockets.pocketSW.knuckleNW.pos.y);e.plane(new T.r(e.X+.5,0,a),1,s,i,t),e.plane(new T.r(-e.X-.5,0,a),1,s,i,t),e.plane(new T.r(-e.X/2,e.Y+.5,a),n,1,i,t),e.plane(new T.r(-e.X/2,-e.Y-.5,a),n,1,i,t),e.plane(new T.r(e.X/2,e.Y+.5,a),n,1,i,t),e.plane(new T.r(e.X/2,-e.Y-.5,a),n,1,i,t)}},{key:"plane",value:function(t,i,a,n,s){var o=new T.c(i,a,n),r=new T.l(o,e.material);r.receiveShadow=!0,r.position.copy(t),s.add(r)}}]),e}();de.tableX=14,de.tableY=22/3,de.X=de.tableX+.5,de.Y=de.tableY+.5,de.PX=de.tableX+1.6,de.PY=de.tableY+1.6,de.knuckleInset=0,de.knuckleRadius=.5,de.middleKnuckleInset=0,de.middleKnuckleRadius=.5,de.cornerRadius=1,de.middleRadius=.4,de.pockets={pocketNW:{pocket:new fe(new T.r(-de.PX,de.PY,0),de.cornerRadius),knuckleNE:new pe(new T.r(-de.X+de.knuckleInset,de.Y+de.knuckleRadius,0),de.knuckleRadius),knuckleSW:new pe(new T.r(-de.X-de.knuckleRadius,de.Y-de.knuckleInset,0),de.knuckleRadius)},pocketN:{pocket:new fe(new T.r(0,de.PY,0),de.middleRadius),knuckleNE:new pe(new T.r(de.knuckleInset,de.Y+de.middleKnuckleRadius,0),de.knuckleRadius),knuckleNW:new pe(new T.r(-de.middleKnuckleInset,de.Y+de.middleKnuckleRadius,0),de.knuckleRadius)},pocketS:{pocket:new fe(new T.r(0,-de.PY,0),de.middleRadius),knuckleSE:new pe(new T.r(de.knuckleInset,-de.Y-de.middleKnuckleRadius,0),de.knuckleRadius),knuckleSW:new pe(new T.r(-de.middleKnuckleInset,-de.Y-de.middleKnuckleRadius,0),de.knuckleRadius)},pocketNE:{pocket:new fe(new T.r(de.PX,de.PY,0),de.cornerRadius),knuckleNW:new pe(new T.r(de.X-de.knuckleInset,de.Y+de.knuckleRadius,0),de.knuckleRadius),knuckleSE:new pe(new T.r(de.X+de.knuckleRadius,de.Y-de.knuckleInset,0),de.knuckleRadius)},pocketSE:{pocket:new fe(new T.r(de.PX,-de.PY,0),de.cornerRadius),knuckleNE:new pe(new T.r(de.X+de.knuckleRadius,-de.Y+de.knuckleInset,0),de.knuckleRadius),knuckleSW:new pe(new T.r(de.X-de.knuckleInset,-de.Y-de.knuckleRadius,0),de.knuckleRadius)},pocketSW:{pocket:new fe(new T.r(-de.PX,-de.PY,0),de.cornerRadius),knuckleSE:new pe(new T.r(-de.X+de.knuckleInset,-de.Y-de.knuckleRadius,0),de.knuckleRadius),knuckleNW:new pe(new T.r(-de.X-de.knuckleRadius,-de.Y+de.knuckleInset,0),de.knuckleRadius)}},de.knuckles=[de.pockets.pocketNW.knuckleNE,de.pockets.pocketNW.knuckleSW,de.pockets.pocketN.knuckleNW,de.pockets.pocketN.knuckleNE,de.pockets.pocketS.knuckleSW,de.pockets.pocketS.knuckleSE,de.pockets.pocketNE.knuckleNW,de.pockets.pocketNE.knuckleSE,de.pockets.pocketSE.knuckleNE,de.pockets.pocketSE.knuckleSW,de.pockets.pocketSW.knuckleSE,de.pockets.pocketSW.knuckleNW],de.pocketCenters=[de.pockets.pocketNW.pocket,de.pockets.pocketSW.pocket,de.pockets.pocketN.pocket,de.pockets.pocketS.pocket,de.pockets.pocketNE.pocket,de.pockets.pocketSE.pocket],de.material=new T.m({color:1118481,wireframe:!1,flatShading:!0});var be=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"willBounce",value:function(t,i){var a=t.futurePosition(i);return t.onTable()&&(e.willBounceLongSegment(de.pockets.pocketNW.knuckleNE.pos.x,de.pockets.pocketN.knuckleNW.pos.x,a)||e.willBounceLongSegment(de.pockets.pocketN.knuckleNE.pos.x,de.pockets.pocketNE.knuckleNW.pos.x,a)||e.willBounceShortSegment(de.pockets.pocketNW.knuckleSW.pos.y,de.pockets.pocketSW.knuckleNW.pos.y,a))}},{key:"willBounceLongSegment",value:function(e,t,i){return i.x>e&&i.x<t&&Math.abs(i.y)>de.tableY}},{key:"willBounceShortSegment",value:function(e,t,i){return i.y>t&&i.y<e&&Math.abs(i.x)>de.tableX}},{key:"bounce",value:function(t,i){var a=t.futurePosition(i);a.x>de.tableX&&e.bounceIn(0,t),a.x<-de.tableX&&e.bounceIn(Math.PI,t),a.y>de.tableY&&e.bounceIn(-Math.PI/2,t),a.y<-de.tableY&&e.bounceIn(Math.PI/2,t)}},{key:"bounceIn",value:function(e,t){var i=new T.r,a=new T.r;!function(e,t,i,a,n,s){s(t.clone().applyAxisAngle(q,e),i.clone().applyAxisAngle(q,e),a,n),a.applyAxisAngle(q,-e),n.applyAxisAngle(q,-e)}(e,t.vel,t.rvel,i,a,le),t.vel.add(i),t.rvel.add(a)}}]),e}();be.elasticity=.8;var me=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"willCollide",value:function(e,t,i){return e.onTable()&&t.onTable()&&e.futurePosition(i).distanceTo(t.futurePosition(i))<1}},{key:"collide",value:function(t,i){e.updateVelocities(t,i)}},{key:"updateVelocities",value:function(e,t){var i=Q(t.pos.clone().sub(e.pos)),a=i.dot(e.vel),n=i.dot(t.vel);e.vel.addScaledVector(i,n).addScaledVector(i,-a),t.vel.addScaledVector(i,a).addScaledVector(i,-n)}}]),e}(),ve=function(){function e(){Object(r.a)(this,e),this.limit=.4,this.maxPower=5,this.aim=new L,this.length=1*de.tableX,this.initialise(.05,.15,this.length)}return Object(l.a)(e,[{key:"initialise",value:function(t,i,a){var n=new T.d(t,i,a,16);this.mesh=new T.l(n,e.material),this.mesh.castShadow=!0,this.mesh.geometry.applyMatrix((new T.k).identity().makeRotationAxis(new T.r(1,0,0),-.1)).applyMatrix((new T.k).identity().makeRotationAxis(q,-Math.PI/2)).applyMatrix((new T.k).identity().makeTranslation(-a/2-1,0,1)),this.mesh.rotation.z=this.aim.angle}},{key:"rotateAim",value:function(e){this.aim.angle+=e,this.aim.dir.applyAxisAngle(q,e),this.mesh.rotation.z=this.aim.angle}},{key:"adjustHeight",value:function(e){this.aim.verticalOffset=T.j.clamp(this.aim.verticalOffset+e,-this.limit,this.limit),this.mesh.position.z=this.aim.verticalOffset}},{key:"adjustSide",value:function(e){this.aim.sideOffset=T.j.clamp(this.aim.sideOffset+e,-this.limit,this.limit)}},{key:"adjustPower",value:function(e){this.aim.power=Math.min(this.maxPower,this.aim.power+e)}},{key:"moveTo",value:function(e){this.aim.pos.copy(e),this.mesh.rotation.z=this.aim.angle;var t=z(this.aim.dir).multiplyScalar(this.aim.sideOffset).setZ(this.aim.verticalOffset),i=this.aim.dir.clone().multiplyScalar(-this.aim.power/2);this.mesh.position.copy(e.clone().add(t).add(i))}},{key:"update",value:function(e){this.moveTo(this.aim.pos)}},{key:"intersectsAnything",value:function(e){var t=e.balls[0].pos.clone().addScaledVector(this.aim.dir,-this.length/2);t.z=this.aim.verticalOffset;var i=this.aim.dir.clone().normalize();return new T.p(t,i,0,this.length/2-.6).intersectObjects(e.balls.map(function(e){return e.mesh.mesh})).length>0}}]),e}();ve.material=new T.m({color:8934775,wireframe:!1,flatShading:!1});var Re=function(){function e(t){Object(r.a)(this,e),this.balls=[],this.cue=new ve,this.outcome=[],this.initialiseBalls(t)}return Object(l.a)(e,[{key:"initialiseBalls",value:function(e){var t=this;this.balls=e,this.pairs=[],this.balls.forEach(function(e){t.balls.forEach(function(i){e!=i&&t.pairs.push({a:e,b:i})})})}},{key:"advance",value:function(e){for(var t=0;!this.prepareAdvanceAll(e);)if(t++>100)throw new Error("Depth exceeded resolving collisions");this.balls.forEach(function(t){t.update(e)})}},{key:"prepareAdvanceAll",value:function(e){var t=this;return!this.pairs.some(function(i){return!t.prepareAdvancePair(i.a,i.b,e)})}},{key:"prepareAdvancePair",value:function(e,t,i){if(me.willCollide(e,t,i))return me.collide(e,t),this.outcome.push({type:"collision",a:e,b:t}),!1;if(be.willBounce(e,i))return be.bounce(e,i),this.outcome.push({type:"cushion",a:e}),!1;var a=pe.willBounceAny(e,i);if(a)return a.bounce(e),this.outcome.push({type:"cushion",a:e}),!1;var n=fe.willFallAny(e,i);return!n||(n.fall(e,i),this.outcome.push({type:"pot",a:e}),!1)}},{key:"allStationary",value:function(){return this.balls.every(function(e){return!e.inMotion()||!e.onTable()})}},{key:"serialise",value:function(){return{balls:this.balls.map(function(e){return e.serialise()}),aim:this.cue.aim.copy()}}},{key:"updateFromSerialised",value:function(e){this.balls.forEach(function(t,i){return ue.updateFromSerialised(t,e.balls[i])}),this.cue.aim=L.fromJson(e.aim)}}],[{key:"fromSerialised",value:function(t){var i=new e(t.balls.map(function(e){return ue.fromSerialised(e)}));return i.cue.aim=L.fromJson(t.aim),i}}]),e}(),ke=function(){function e(t){Object(r.a)(this,e),this.mode=this.topView,this.topViewPoint=new T.r(0,-.1,30),this.camera=new T.o(40,t,.1,1e7)}return Object(l.a)(e,[{key:"update",value:function(e,t){this.mode(t)}},{key:"topView",value:function(e){this.camera.position.lerp(this.topViewPoint,.1),this.camera.up=q,this.camera.lookAt(I)}},{key:"aimView",value:function(e){this.camera.position.lerp(this.topViewPoint,.1),this.camera.up=q,this.camera.lookAt(I)}},{key:"afterHitView",value:function(e){this.camera.position.addScaledVector(q,.01),this.camera.up=q,this.camera.lookAt(e)}}]),e}(),ye=function(){function e(t){Object(r.a)(this,e),this.scene=new T.q,void 0!==t?(this.renderer=new T.s,this.initialiseScene(t,t.offsetWidth,t.offsetHeight),this.addCamera(t.offsetWidth,t.offsetHeight)):this.addCamera(1,1),this.addLights(),this.addTable()}return Object(l.a)(e,[{key:"update",value:function(e,t){this.camera.update(e,t)}},{key:"render",value:function(){this.renderer.render(this.scene,this.camera.camera)}},{key:"initialiseScene",value:function(e,t,i){this.renderer.setSize(t,i),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=T.n,e.appendChild(this.renderer.domElement)}},{key:"addCamera",value:function(e,t){this.camera=new ke(e/t)}},{key:"addLights",value:function(){var e=1.3,t=new T.e(16777215,1);t.position.set(.1,-.01,10),t.shadow.camera.near=4,t.shadow.camera.far=12,t.shadow.camera.right=de.X*e,t.shadow.camera.left=-de.X*e,t.shadow.camera.top=de.Y*e,t.shadow.camera.bottom=-de.Y*e,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.castShadow=!0,this.scene.add(t),this.scene.add(new T.a(5263440,1))}},{key:"addTable",value:function(){de.addToScene(this.scene)}},{key:"addMesh",value:function(e){this.scene.add(e)}}]),e}(),Ve=function(){function e(){Object(r.a)(this,e)}return Object(l.a)(e,null,[{key:"jitter",value:function(t){return t.clone().add(new T.r(e.noise*(Math.random()-.5),e.noise*(Math.random()-.5),0))}},{key:"cueBall",value:function(){return new ue(new T.r(-11,0,0))}},{key:"diamond",value:function(){var t=new T.r(0,e.gap,0),i=t.clone().applyAxisAngle(e.up,1*Math.PI/3),a=new T.r(de.tableX/2,0,0),n=[];return n.push(e.cueBall()),n.push(new ue(e.jitter(a))),a.add(i),n.push(new ue(e.jitter(a))),a.sub(t),n.push(new ue(e.jitter(a))),a.add(i),n.push(new ue(e.jitter(a))),a.sub(t),n.push(new ue(e.jitter(a))),a.add(t),a.add(t),n.push(new ue(e.jitter(a))),a.add(i).sub(t),n.push(new ue(e.jitter(a))),a.sub(t),n.push(new ue(e.jitter(a))),a.add(i),n.push(new ue(e.jitter(a))),n}},{key:"cushion3",value:function(){var t=new T.r(0,e.gap,0),i=t.clone().applyAxisAngle(e.up,1*Math.PI/3),a=new T.r(de.tableX/2,0,0),n=[];return n.push(e.cueBall()),n.push(new ue(e.jitter(a))),a.add(i).sub(t),n.push(new ue(e.jitter(a))),n}}]),e}();Ve.noise=.02,Ve.gap=1+2*Ve.noise,Ve.up=new T.r(0,0,-1);var we=function(){function e(t,i){var a=this;Object(r.a)(this,e),this.inputQueue=[],this.eventQueue=[],this.last=performance.now(),this.step=.01,this.log=i,this.table=new Re(Ve.cushion3()),this.view=new ye(t),this.table.balls.forEach(function(e){return a.view.addMesh(e.mesh.mesh)}),this.view.addMesh(this.table.cue.mesh),this.updateController(new Ne(this))}return Object(l.a)(e,[{key:"sendEvent",value:function(){}},{key:"advance",value:function(e){for(var t=Math.max(15,Math.floor(e/this.step)),i=this.table.allStationary(),a=0;a<t;a++)this.table.advance(this.step);this.view.update(t*this.step,this.table.cue.aim),this.table.cue.update(t*this.step),!i&&this.table.allStationary()&&this.eventQueue.push(new F)}},{key:"processEvents",value:function(){var e=this.inputQueue.shift();e&&this.updateController(this.controller.handleInput(e));var t=this.eventQueue.shift();t&&this.updateController(t.applyToController(this.controller))}},{key:"animate",value:function(e){var t=this;this.advance((e-this.last)/1e3),this.view.render(),this.last=e,this.processEvents(),requestAnimationFrame(function(e){t.animate(e)})}},{key:"updateController",value:function(e){e!=this.controller&&this.log("Transition to "+e.constructor.name),this.controller=e}}]),e}(),_e=function(){function e(t){Object(r.a)(this,e),this.container=t}return Object(l.a)(e,[{key:"handleInput",value:function(e){return this}},{key:"handleBegin",value:function(e){return this}},{key:"handleAim",value:function(e){return this}},{key:"handleHit",value:function(e){return this}},{key:"handleAbort",value:function(e){return this}},{key:"handleWatch",value:function(e){return this}},{key:"handleStationary",value:function(e){return this}}]),e}(),ge=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(h.a)(t).call(this))).type=O.BEGIN,e}return Object(u.a)(t,e),Object(l.a)(t,[{key:"applyToController",value:function(e){return e.handleBegin(this)}}]),t}(X),Me=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),t}(_e),xe=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(c.a)(this,Object(h.a)(t).call(this,e))).scale=1e-6,i.container.table.cue.moveTo(i.container.table.balls[0].pos),i.container.view.camera.mode=i.container.view.camera.topView,i}return Object(u.a)(t,e),Object(l.a)(t,[{key:"handleAim",value:function(e){return this.container.table.cue.aim=e,this}},{key:"handleHit",value:function(e){return this.container.table.updateFromSerialised(e.json),new Se(this.container,!0)}},{key:"handleAbort",value:function(e){return new Me(this.container)}}]),t}(_e),Se=function(e){function t(e,i){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).allStationary=!1,a.isWatch=i,a.container.table.outcome=[],a.hit(),a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"handleAim",value:function(e){return this.allStationary?(this.container.log("all stationary so transition to Aim now"),new Ae(this.container)):(this.container.log("pending transition to Aim"),this.pendingState=new Ae(this.container),this)}},{key:"handleWatch",value:function(e){return this.allStationary?(this.container.log("all stationary so transition to WatchAim now"),new xe(this.container)):(this.container.log("pending transition to WatchAim"),this.pendingState=new xe(this.container),this)}},{key:"handleStationary",value:function(e){return this.allStationary=!0,new Ae(this.container)}},{key:"handleAbort",value:function(e){return new Me(this.container)}},{key:"hit",value:function(){var e=this.container.table,t=e.cue.aim;console.log(t),e.balls[0].vel.copy(t.dir.clone().multiplyScalar(t.power)),console.log(z(t.dir));var i=z(t.dir).multiplyScalar(t.power*t.verticalOffset*5/2);i.z=5*-t.sideOffset/2,e.balls[0].rvel.copy(i),e.cue.aim.power=0}}]),t}(_e),Ae=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(c.a)(this,Object(h.a)(t).call(this,e))).scale=.001,i.container.table.cue.moveTo(i.container.table.balls[0].pos),i.container.table.cue.aim.power=0,i.container.view.camera.mode=i.container.view.camera.aimView,i}return Object(u.a)(t,e),Object(l.a)(t,[{key:"handleInput",value:function(e){switch(e.key){case"ArrowLeft":this.container.table.cue.rotateAim(-e.t*this.scale);break;case"ArrowRight":this.container.table.cue.rotateAim(e.t*this.scale);break;case"ArrowDown":this.container.table.cue.adjustHeight(-e.t*this.scale);break;case"ArrowUp":this.container.table.cue.adjustHeight(e.t*this.scale);break;case"ShiftArrowLeft":this.container.table.cue.adjustSide(e.t*this.scale);break;case"ShiftArrowRight":this.container.table.cue.adjustSide(-e.t*this.scale);break;case"Space":this.container.table.cue.adjustPower(e.t*this.scale*3);break;case"SpaceUp":return this.hit();default:return this}return this}},{key:"hit",value:function(){return new Se(this.container,!1)}},{key:"handleAbort",value:function(e){return new Me(this.container)}}]),t}(_e),Ne=function(e){function t(){return Object(r.a)(this,t),Object(c.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(l.a)(t,[{key:"handleBegin",value:function(e){return new Ae(this.container)}},{key:"handleAbort",value:function(e){return new Me(this.container)}},{key:"handleWatch",value:function(e){return this.container.table.updateFromSerialised(e.json),new xe(this.container)}}]),t}(_e),je=function(){function e(){var t=this;Object(r.a)(this,e),this.pressed={},this.released={},this.keydown=function(e){e=e||window.event,t.pressed[e.code]=!0,e.stopImmediatePropagation()},this.keyup=function(e){e=e||window.event,delete t.pressed[e.code],t.released[e.code]=!0,e.stopImmediatePropagation()},this.addHandlers()}return Object(l.a)(e,[{key:"getEvents",value:function(e){var t=Object.keys(this.pressed).filter(function(e){return!/.*Shift.*/.test(e)}).filter(function(e){return!/.*Control.*/.test(e)}),i=Object.keys(this.pressed).some(function(e){return/.*Shift.*/.test(e)}),a=Object.keys(this.pressed).some(function(e){return/.*Control.*/.test(e)}),n=t.map(function(t){return new D(a?e/3:e,i?"Shift"+t:t)});return Object.keys(this.released).forEach(function(t){return n.push(new D(e,t+"Up"))}),this.released={},n}}]),Object(l.a)(e,[{key:"addHandlers",value:function(){document.addEventListener("keydown",this.keydown),document.addEventListener("keyup",this.keyup)}}]),e}(),Ce=function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(c.a)(this,Object(h.a)(t).call(this,e))).meshPicked=function(e){},i.drawBallPath=function(e){i.board.drawBallPath(e)},i.onSceneMount=function(e){var t=e.canvas,a=e.scene;i.board.initializeScene(a,t)},i.toggleGrids=function(e){i.board.toggleGrids(e)},i.playSimulation=function(){i.board.playSimulation()},i.updateControlOptions=function(e){i.board.updateControlOptions(e)},i.componentDidMount=function(){console.log(i.simulatorDom.current);var e=new we(i.simulatorDom.current,function(e){});e.eventQueue.push(new ge);var t=new je,a=performance.now();!function i(){var n=performance.now()-a;a=performance.now(),t.getEvents(n).forEach(function(t){return e.inputQueue.push(t)}),requestAnimationFrame(function(e){i()})}(),e.animate(performance.now())},i.state={showPath:!1},i.board=new P(i.props.size,i.props.modelStorePath,i.props.currentView,{posCueBallWhite:{x:i.props.posCueBallWhite.x,z:i.props.posCueBallWhite.z},posCueBallYellow:{x:i.props.posCueBallYellow.x,z:i.props.posCueBallYellow.z},posTargetBall:{x:i.props.posTargetBall.x,z:i.props.posTargetBall.z}},{cueLine:i.props.cueLine,cueAngle:i.props.cueAngle,sideEnglish:i.props.sideEnglish,topSpin:i.props.topSpin,speed:i.props.speed}),i.simulatorDom=new n.a.createRef,i}return Object(u.a)(t,e),Object(l.a)(t,[{key:"changeView",value:function(e){this.board.changeView(e)}},{key:"render",value:function(){return n.a.createElement("div",{ref:this.simulatorDom,style:{height:"100%",width:"100%",display:"block"}})}}]),t}(n.a.Component),Ye=i(9),Be=i(10),Pe=(i(32),function(e){function t(e){var i;return Object(r.a)(this,t),(i=Object(c.a)(this,Object(h.a)(t).call(this,e))).componentWillReceiveProps=function(e){var t=e.value;i.setState({value:t})},i.updateValue=function(e){i.setState({value:e}),i.props.onUpdate(i.props.itemKey,e)},i.onChangeValue=function(e){var t=e.target.value;i.updateValue(t)},i.onMinusPressed=function(){var e=i.state.value,t=i.props,a=t.min,n=t.step;void 0===n&&(n=.1),(e=(10*e-(n*=10))/10)<a&&(e=a),i.updateValue(e)},i.onPlusPressed=function(){var e=i.state.value,t=i.props,a=t.max,n=t.step;void 0===n&&(n=.1),(e=(10*e+(n*=10))/10)>a&&(e=a),i.updateValue(e)},i.state={value:i.props.value?i.props.value:0},i}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.value,t=this.props,i=t.containerClass,a=t.label,s=t.min,o=t.max,r=t.unitDom,l=t.step;return void 0===l&&(l=.1),n.a.createElement("div",{className:i},n.a.createElement("div",{style:{display:"flex"}},n.a.createElement(Ye.a,{icon:Be.d,className:"btn-change-value",onClick:this.onMinusPressed}),n.a.createElement("span",{style:{flex:1,textAlign:"center"}},a,n.a.createElement("span",null," : ",e,r)),n.a.createElement(Ye.a,{icon:Be.f,className:"btn-change-value",onClick:this.onPlusPressed})),n.a.createElement("input",{type:"range",min:s,max:o,value:e,className:"slider",step:l,onChange:this.onChangeValue}))}}]),t}(n.a.Component)),Xe=(i(33),n.a.Component,function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(c.a)(this,Object(h.a)(t).call(this))).componentWillMount=function(){e.updateSimulateInfo()},e.updateSimulateInfo=function(){var t=["Santiago  Soto Sanchez","...","0","310","2","1","1.1661666666666661","0.6288333333333332","0.8181666666666672","0.5041666666666665","-0.6036666666666667","-0.003833333333333161","4.015999999999998","0.520497057626843","0.21066799020683835","-0.0013500000000002585","-0.0146999999999997"],i={size:2.8,cueLine:parseFloat(t[x]),cueAngle:parseFloat(t[M]),sideEnglish:parseFloat(t[S]),topSpin:parseFloat(t[A]),speed:parseFloat(t[g]),posCueBallWhite:{x:parseFloat(t[R]),z:parseFloat(t[k])},posCueBallYellow:{x:parseFloat(t[y]),z:parseFloat(t[V])},posTargetBall:{x:parseFloat(t[w]),z:parseFloat(t[_])}};e.setState(i)},e.viewSelectorItemClicked=function(t){e.setState({currentView:t}),e.simulator.current.changeView(t)},e.onToggleShowGrid=function(t){e.setState({showGrid:t}),e.simulator.current.toggleGrids(t)},e.onToggleShowPath=function(t){e.setState({showPath:t}),e.simulator.current.drawBallPath(t)},e.onPlayPressed=function(){e.simulator.current.playSimulation()},e.onControlOptionsUpdated=function(t){e.simulator.current.updateControlOptions(t)},e.componentDidMount=function(){},e.state={currentView:"2d",showGrid:!0,showPath:!1,size:310,cueLine:30,cueAngle:5,sideEnglish:-8.7,topSpin:7.5,speed:380,posCueBallWhite:{},posCueBallYellow:{},posTargetBall:{}},e.simulator=n.a.createRef(),e}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.currentView,i=(e.showGrid,e.showPath,e.size),a=e.cueLine,s=e.cueAngle,o=e.sideEnglish,r=e.topSpin,l=e.speed,c=e.posCueBallWhite,h=e.posCueBallYellow,u=e.posTargetBall;return n.a.createElement("div",{className:"simulator-container"},n.a.createElement(Ce,{modelStorePath:this.props.modelStorePath,ref:this.simulator,size:i,currentView:t,cueLine:a,cueAngle:s,sideEnglish:o,topSpin:r,speed:l,posCueBallWhite:c,posCueBallYellow:h,posTargetBall:u}))}}]),t}(n.a.Component));var Oe=function(){return n.a.createElement("div",{className:"simulator-container"},n.a.createElement(Xe,{modelStorePath:"./models/"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(Oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[18,1,2]]]);
//# sourceMappingURL=main.924962ea.chunk.js.map